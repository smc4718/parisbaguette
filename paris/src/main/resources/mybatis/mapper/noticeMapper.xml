<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pyj.paris.dao.NoticeMapper">

    <resultMap type="NoticeDto" id="NoticeMap">
        <id     column="NOTICE_NO"  property="noticeNo" />
        <result column="TITLE"      property="title" />
        <result column="CONTENTS"   property="contents" />
        <result column="HIT"        property="hit" />
        <result column="CREATED_AT" property="createdAt" />
        <association javaType="UserDto"  property="userDto">
            <id      column="USER_NO"    property="userNo" />
            <result  column="EMAIL"      property="email" />
            <result  column="PW"         property="pw" />
            <result  column="NAME"       property="name" />
            <result  column="GENDER"     property="gender" />
            <result  column="MOBILE"     property="mobile" />
            <result  column="JOINED_AT"  property="joinedAt" />
        </association>
    </resultMap>

    <!-- 공지 갯수 -->
    <select id="getNoticeCount" resultType="int">
        SELECT COUNT(*)
          FROM NOTICE_T
    </select>

    <!-- 공지 리스트 -->
    <select id="getNoticeList" parameterType="Map" resultType="NoticeDto">
        SELECT NOTICE_NO, USER_NO, TITLE, CONTENTS, HIT, CREATED_AT
          FROM (SELECT ROW_NUMBER() OVER(ORDER BY NOTICE_NO DESC) AS RN, NOTICE_NO, USER_NO, TITLE, CONTENTS, HIT, CREATED_AT
                  FROM NOTICE_T) NU
         WHERE RN BETWEEN #{begin} AND #{end}
    </select>

    <!-- 공지 등록 -->
    <insert id="insertNotice" parameterType="NoticeDto">
        <selectKey order="BEFORE" keyProperty="noticeNo" resultType="int">
            SELECT NOTICE_SEQ.NEXTVAL
              FROM DUAL
        </selectKey>
        INSERT INTO NOTICE_T(
            NOTICE_NO
          , USER_NO
          , TITLE
          , CONTENTS
          , HIT
          , CREATED_AT
        ) VALUES (
            #{noticeNo}
          , #{userDto.userNo}
          , #{title}
          , #{contents}
          , #{hit}
          , #{createdAt}
        )
    </insert>

    <!-- 공지 상세 -->
    <select id="getNotice" parameterType="int" resultMap="NoticeMap">
        SELECT NOTICE_NO, USER_NO, TITLE, CONTENTS, HIT, CREATED_AT
          FROM NOTICE_T
         WHERE NOTICE_NO = #{noticeNo}
    </select>


</mapper>